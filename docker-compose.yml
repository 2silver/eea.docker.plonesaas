version: "2"
services:
  haproxy:
    image: eeacms/haproxy:1.8-1.2
    ports:
    - 80:8080
    - 1936:1936
    depends_on:
    - plone
    environment:
      FRONTEND_PORT: "8080"
      BACKENDS_PORT: "8080"
      BACKENDS: "plone"
      DNS_ENABLED: "True"
      TZ: "Europe/Bucharest"

  plone:
    image: avoinea/plone
    depends_on:
    - postgres
    - memcached
    - postfix
    environment:
      ZOPE_MODE: "rel_client"
      TZ: "Europe/Bucharest"
    volumes:
    - blobs:/data/blobstorage

  async:
    image: avoinea/plone
    depends_on:
    - postgres
    - memcached
    - postfix
    environment:
      ZOPE_MODE: "rel_async"
      TZ: "Europe/Bucharest"
    volumes:
    - blobs:/data/blobstorage

  postgres:
    image: eeacms/postgres:9.6-3.5
    ports:
    - 5432:5432
    environment:
      POSTGRES_DBNAME: "datafs zasync"
      POSTGRES_DBUSER: "zope"
      POSTGRES_DBPASS: "zope"
      POSTGRES_USER: "postgres"
      POSTGRES_PASSWORD: "postgres"
      TZ: "Europe/Bucharest"
    volumes:
    - data:/var/lib/postgresql/data

  memcached:
    image: memcached:1.5.12
    command:
    - "-m"
    - "2048"
    environment:
      TZ: "Europe/Bucharest"

  postfix:
    image: eeacms/postfix:2.10-3.3
    environment:
      MTP_HOST: "avoinea.com"
      TZ: "Europe/Bucharest"

  elastic:
    image: eeacms/elastic:6.6-1.0
    environment:
      cluster.name: "plone"
      ES_JAVA_OPTS: "-Xms512m -Xmx512m"
      TZ: "Europe/Bucharest"

volumes:
  data:
    driver: local
  blobs:
    driver: local
